#!/bin/bash

LINES=7
WIDTH=180

DIRNAME=$(dirname $0)
source $DIRNAME/popup_config
source $DIRNAME/mouselocation

JST=$(date -d "+9 hours" +"%H:%M")
HKT=$(date -d "+8 hours" +"%H:%M")
CET=$(date +"%H:%M")
GMT=$(date -d "-2 hours" +"%H:%M")
EST=$(date -d "-6 hours" +"%H:%M")
PST=$(date -d "-9 hours" +"%H:%M")

JST_difference=$(date -d "+9 hours" +"%_d")
HKT_difference=$(date -d "+8 hours" +"%_d")
CET_difference=$(date +"%_d")
GMT_difference=$(date -d "-2 hours" +"%_d")
EST_difference=$(date -d "-6 hours" +"%_d")
PST_difference=$(date -d "-9 hours" +"%_d")

difference() {
	_HOME=$1
	AWAY=$2
	AWAY_day=$(echo $AWAY | awk '{print $1}')
	_HOME_day=$(echo $_HOME | awk '{print $1}')
	AWAY_month=$(echo $AWAY | awk '{print $2}')
	_HOME_month=$(echo $_HOME | awk '{print $2}')
	if [[ $AWAY_day -gt $_HOME_day ]]; then
		if [[ $AWAY_month -lt $_HOME_month ]]; then
			echo "-1"
		else
			echo "+1"
		fi
	elif [[ $AWAY_day -lt $_HOME_day ]]; then  
		if [[ $AWAY_month -gt $_HOME_month ]]; then
			echo "+1"
		else
			echo "-1"
		fi
	else
		echo "±0"
	fi
	
}

(echo "Timezones"
echo "$PAD^fg("$label")Tōkyō:       ^fg()$JST" $(difference $CET_difference $JST_difference)
echo "$PAD^fg("$label")Hēunggóng:   ^fg()$HKT" $(difference $CET_difference $HKT_difference)
echo "$PAD^fg("$label")Göteborg:    ^fg()$CET" $(difference $CET_difference $CET_difference)
echo "$PAD^fg("$label")Reykjavík:   ^fg()$GMT" $(difference $CET_difference $GMT_difference)
echo "$PAD^fg("$label")New York:    ^fg()$EST" $(difference $CET_difference $EST_difference)
echo "$PAD^fg("$label")Los Angeles: ^fg()$PST" $(difference $CET_difference $PST_difference)
) | dzen2 -p "$TIME" -x 1720 -w "$WIDTH" -l "$LINES" -sa 'l' -title-name 'popup_timezones' -fn "$FONT" ${OPTIONS}

